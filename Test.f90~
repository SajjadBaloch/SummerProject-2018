program FindnthMin
	implicit none
	integer :: N=10
	real*8,dimension(9,10) :: array
	real*8,dimension(10) :: M
	real*8,allocatable :: search(:),mass(:)
	real*8 :: Mloc,ind,rsphere
	integer :: k=5	! Find the nth lowest value in array
	real*8 :: dummy	! A dummy variable
	integer :: i,j	! iteration integer
	
	do i=1,N
		do j=1,N
			call random_number(dummy)	! Random number between 0 and 100
			dummy=dummy*1d2
			array(j,i)=dummy
		enddo
		call random_number(dummy)
		dummy=dummy*1d3
		M(i)=dummy
	enddo
		
! Search for kth nearest body
	do i=1,N
		! Initialise the search for body i's kth nearest body
		search=array(:,i)
		mass=(/M(1:i-1),M(i+1:)/)
		Mloc=M(i)
		do j=1,k
			print '(5F12.6)',search
			print*
			print '(5F12.6)',mass
			print*
			! Index of current minimum
			ind=MINLOC(search,1)
			! Add this body's mass to the local total
			Mloc=Mloc+mass(nint(ind))
			if (j .eq. k) exit
			! Remove this minimum from search to find next minimum
			search=(/search(1:nint(ind)-1),search(nint(ind)+1:)/)
			mass=(/mass(i:nint(ind)-1),mass(nint(ind)+1:)/)
		enddo
		! Calculate the local density for body i
		rsphere=MINVAL(search)
		print*,rsphere
		print*,Mloc
		print*
	enddo


end program
